<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0f1419">
<title>åŒ—æµ· ä»•å…¥ã‚ŒãƒŠãƒ“</title>
<style>
:root{--bg:#0f1419;--card:#1a2230;--border:#253040;--tx:#e4e9f0;--dim:#6e7f92;--mt:#3a4858;--ac:#f97316;--fish:#0ea5e9;--sake:#eab308;--food:#22c55e;--red:#ef4444;--blue:#3b82f6}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Hiragino Sans','Noto Sans JP',sans-serif;background:var(--bg);color:var(--tx);-webkit-tap-highlight-color:transparent;overflow-x:hidden;font-size:14px;line-height:1.5}
button{font-family:inherit}
.hd{background:linear-gradient(135deg,#1a1040,#0f1419);padding:14px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50}
.hd h1{font-size:16px;font-weight:900}.hd h1 b{color:var(--ac)}.hd p{font-size:10px;color:var(--dim);margin-top:1px}
.wrap{padding:12px 12px 80px}
.tabs{display:flex;gap:5px;margin-bottom:14px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.tab{flex-shrink:0;padding:7px 13px;border-radius:20px;font-size:11px;font-weight:700;border:1px solid var(--border);background:var(--card);color:var(--dim);cursor:pointer}
.tab.on{background:var(--ac);color:#fff;border-color:var(--ac)}
.cd{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:10px}
.cd-t{font-size:11px;font-weight:700;color:var(--dim);letter-spacing:.5px;margin-bottom:10px}
.drow{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.drow input[type=date]{flex:1;background:var(--card);color:var(--tx);border:1px solid var(--border);border-radius:8px;padding:10px;font-size:15px;font-family:inherit;-webkit-appearance:none}
.go{background:var(--ac);color:#fff;border:none;border-radius:8px;padding:10px 14px;font-size:13px;font-weight:700;cursor:pointer}
.frow{display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:6px;scroll-snap-type:x mandatory}.frow::-webkit-scrollbar{display:none}
.fday{flex:0 0 calc(33.33% - 6px);scroll-snap-align:start;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 8px;text-align:center;min-width:110px}
.fday.hi{border-color:var(--ac);background:rgba(249,115,22,.06)}.fday.off{opacity:.4}
.fday .dow{font-size:20px;font-weight:900;margin:2px 0}.fday .dow.fs{color:var(--ac)}
.fday .dt{font-size:10px;color:var(--dim)}.fday .wi{font-size:30px;margin:6px 0;line-height:1}
.fday select{width:100%;background:var(--bg);color:var(--tx);border:1px solid var(--border);border-radius:6px;padding:6px 2px;font-size:11px;font-family:inherit;text-align:center;-webkit-appearance:none}
.mode-sel{display:flex;gap:6px;margin-bottom:10px}
.mode-btn{flex:1;padding:10px 6px;border-radius:8px;font-size:11px;font-weight:700;border:2px solid var(--border);background:var(--card);color:var(--dim);cursor:pointer;text-align:center;line-height:1.3}
.mode-btn.on{color:#fff}
.mode-btn .pct{font-size:18px;font-weight:900;display:block;margin-bottom:2px}
.mode-btn .mlabel{font-size:9px;opacity:.7}
.bigbtn{display:block;width:100%;background:linear-gradient(135deg,var(--ac),#ea580c);color:#fff;border:none;border-radius:10px;padding:14px;font-size:16px;font-weight:900;margin:14px 0;cursor:pointer}
.sstrip{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.sbox{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center}
.sbox .sv{font-size:22px;font-weight:900;letter-spacing:-.5px}.sbox .sl{font-size:10px;color:var(--dim);margin-top:2px}
.sbox.t1{border-color:var(--ac);grid-column:1/3}.sbox.t1 .sv{color:var(--ac);font-size:28px}
.cost-badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:900}
.cost-badge.red{background:rgba(239,68,68,.15);color:var(--red)}
.cost-badge.yellow{background:rgba(234,179,8,.15);color:var(--sake)}
.cost-badge.green{background:rgba(34,197,94,.15);color:var(--food)}
.comp-bar{margin:12px 0;padding:12px;background:rgba(255,255,255,.03);border-radius:8px}
.comp-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:11px}
.comp-row:last-child{margin:0}
.comp-row .clbl{width:60px;color:var(--dim);flex-shrink:0}
.comp-row .cbar{flex:1;height:16px;border-radius:4px;overflow:hidden;background:rgba(255,255,255,.04)}
.comp-row .cfill{height:100%;border-radius:4px;display:flex;align-items:center;justify-content:flex-end;padding-right:6px;font-size:9px;font-weight:700;color:#fff}
.rrow{display:flex;flex-direction:column;gap:8px}
.rday{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:12px}
.rday.off{opacity:.35}
.rday .rl{flex-shrink:0;width:54px;text-align:center}
.rday .rl .rdow{font-size:16px;font-weight:900}.rday .rl .rdow.fs{color:var(--ac)}
.rday .rl .rdt{font-size:10px;color:var(--dim)}.rday .rl .rwi{font-size:18px}
.rday .rc{flex:1}
.rday .rsal{font-size:20px;font-weight:900;color:var(--ac);letter-spacing:-.5px}
.rday .rsal small{font-size:11px;color:var(--dim);font-weight:400;margin-left:4px}
.rday .rpur{display:flex;gap:10px;margin-top:4px;flex-wrap:wrap}
.rday .rp{font-size:12px;display:flex;align-items:center;gap:3px}
.rp .dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}.rp b{font-weight:700}
.df{background:var(--fish)}.ds{background:var(--sake)}.dfd{background:var(--food)}
.cf{color:var(--fish)}.cs{color:var(--sake)}.cfd{color:var(--food)}
.tax-note{font-size:10px;color:var(--dim);padding:8px 10px;background:rgba(255,255,255,.03);border-radius:6px;margin-top:10px;line-height:1.6}
.arow{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)}.arow:last-child{border:none}
.arow .al{flex:1;font-size:13px}.arow .av{font-size:15px;font-weight:900;min-width:70px;text-align:right}
.abr{height:6px;border-radius:3px;margin-top:4px}
.kv{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.kv:last-child{border:none}.kv .k{color:var(--dim)}.kv .v{font-weight:700}
.find{background:rgba(249,115,22,.07);border:1px solid rgba(249,115,22,.2);border-radius:10px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.7}
.find b{color:var(--ac)}.find .ft{font-size:11px;font-weight:900;color:var(--ac);margin-bottom:6px}
.warn-box{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.25);border-radius:10px;padding:14px;margin-bottom:12px;font-size:13px;line-height:1.7}
.warn-box b{color:var(--red)}.warn-box .wt{font-size:11px;font-weight:900;color:var(--red);margin-bottom:6px}
.sim-slider{margin:14px 0}
.sim-slider label{display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px}
.sim-slider label b{color:var(--ac);font-size:16px}
.sim-slider input[type=range]{-webkit-appearance:none;width:100%;height:8px;border-radius:4px;background:var(--border);outline:none}
.sim-slider input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border-radius:50%;background:var(--ac);cursor:pointer;border:3px solid var(--bg)}
.sim-ticks{display:flex;justify-content:space-between;font-size:9px;color:var(--dim);margin-top:2px;padding:0 2px}
.sim-big{text-align:center;padding:20px;border-radius:12px;margin-bottom:12px}
.sim-big .sb-v{font-size:36px;font-weight:900;letter-spacing:-1px}.sim-big .sb-l{font-size:12px;margin-top:4px}
.sim-vs{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;margin:12px 0}
.sim-vs .sv-box{text-align:center;padding:12px;border-radius:10px;background:var(--card);border:1px solid var(--border)}
.sim-vs .sv-box .svv{font-size:20px;font-weight:900}.sim-vs .sv-box .svl{font-size:10px;color:var(--dim);margin-top:2px}
.sim-vs .sv-arrow{font-size:20px;color:var(--ac)}
.bep-box{background:linear-gradient(135deg,rgba(249,115,22,.1),rgba(234,179,8,.1));border:1px solid rgba(249,115,22,.3);border-radius:12px;padding:16px;text-align:center;margin:12px 0}
.bep-box .bep-v{font-size:28px;font-weight:900;color:var(--ac)}.bep-box .bep-l{font-size:12px;color:var(--dim);margin-top:4px}
.cum-legend{display:flex;gap:12px;margin-top:10px;font-size:10px;color:var(--dim);flex-wrap:wrap}
.cum-legend i{display:inline-block;width:10px;height:10px;border-radius:2px;margin-right:3px;vertical-align:middle}
.cum-total-line{text-align:right;font-size:14px;font-weight:900;margin-top:8px;padding:10px 0;border-top:1px solid var(--border)}
/* Preset buttons */
.preset-row{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.preset{padding:8px 12px;border-radius:8px;font-size:11px;font-weight:700;border:1px solid var(--border);background:var(--card);color:var(--dim);cursor:pointer;line-height:1.3;text-align:center;flex:1;min-width:80px}
.preset:active{transform:scale(.96)}
.preset b{display:block;font-size:13px;margin-bottom:2px}
.hide{display:none}
</style>
</head>
<body>
<div class="hd"><h1>ğŸ® åŒ—æµ· <b>ä»•å…¥ã‚ŒãƒŠãƒ“</b></h1><p>å£²ä¸Šäºˆæ¸¬ï¼‹3è»¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï½œ2025å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ v4.2</p></div>
<div class="wrap">
<div class="tabs">
  <div class="tab on" onclick="showTab(0)">ğŸ“Š äºˆæ¸¬</div>
  <div class="tab" onclick="showTab(1)">ğŸ“ˆ åˆ†æ</div>
  <div class="tab" onclick="showTab(2)">ğŸŸ åŸä¾¡</div>
  <div class="tab" onclick="showTab(3)">ğŸ”® æ”¹å–„</div>
  <div class="tab" onclick="showTab(4)">âš™ ãƒ¢ãƒ‡ãƒ«</div>
</div>
<!-- TAB 0 -->
<div id="tab0">
  <div class="drow"><input type="date" id="sd"><button class="go" onclick="genWeek()">è¡¨ç¤º</button></div>
  <div class="cd-t">â‘  å¤©æ°—ã‚’å…¥åŠ›ï¼ˆâ†’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰</div>
  <div class="frow" id="frow"></div>
  <div class="cd-t" style="margin-top:14px">â‘¡ ä»•å…¥ã‚Œãƒ¢ãƒ¼ãƒ‰</div>
  <div class="mode-sel" id="modeSel"></div>
  <div id="modeDesc" style="font-size:11px;color:var(--dim);margin-bottom:8px;line-height:1.6"></div>
  <button class="bigbtn" onclick="calc()">ğŸ”® å£²ä¸Šäºˆæ¸¬ï¼†ä»•å…¥ã‚Œè¨ˆç®—</button>
  <div id="res" class="hide">
    <div id="costAlert"></div>
    <div class="cd-t">é€±é–“ã‚µãƒãƒªãƒ¼</div>
    <div class="sstrip" id="sstrip"></div>
    <div id="compArea"></div>
    <div id="predCum" class="cd" style="display:none">
      <div class="cd-t">ğŸ“ˆ ã“ã®æ”¹å–„ã‚’ç¶šã‘ã‚‹ã¨â€¦ï¼ˆ2025å¹´å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰</div>
      <div id="predCumChart"></div>
    </div>
    <div class="cd-t">æ—¥åˆ¥ äºˆæ¸¬ï¼†ä»•å…¥ã‚Œ</div>
    <div class="rrow" id="rrow"></div>
    <div class="tax-note">ğŸ’° å…¨é¡ç¨è¾¼ã€‚âš  åœŸæ›œé®®é­šâˆ’20%</div>
  </div>
</div>
<!-- TAB 1 -->
<div id="tab1" class="hide">
  <div class="find"><div class="ft">ğŸ“Š 365æ—¥åˆ†æ</div><b>å£²ä¸Šï¼æ›œæ—¥ã§æ±ºã¾ã‚‹ã€‚</b>é‡‘Â¥207Kãƒ»åœŸÂ¥195K vs ç«Â¥134Kã€‚å¤©å€™ã¯ã»ã¼ç„¡é–¢ä¿‚ã€‚</div>
  <div class="cd"><div class="cd-t">æ›œæ—¥åˆ¥ å¹³å‡å£²ä¸Š</div><div id="dowList"></div></div>
  <div class="cd"><div class="cd-t">æ™‚é–“å¸¯åˆ¥</div><div id="timeList"></div></div>
  <div class="cd"><div class="cd-t">å¤©å€™ã®å½±éŸ¿</div><div style="overflow-x:auto"><table style="width:100%;font-size:11px;border-collapse:collapse;white-space:nowrap"><thead><tr style="color:var(--dim);border-bottom:1px solid var(--border)"><th style="padding:6px;text-align:left">æ›œ</th><th style="padding:6px;text-align:right">â˜€</th><th style="padding:6px;text-align:right">ğŸŒ¦</th><th style="padding:6px;text-align:right">ğŸŒ§</th><th style="padding:6px;text-align:right">â„</th></tr></thead><tbody id="wtbl"></tbody></table></div></div>
  <div class="cd"><div class="cd-t">æœˆåˆ¥å£²ä¸Š</div><div id="monList"></div></div>
  <div class="cd"><div class="cd-t">ç›¸é–¢ä¿‚æ•°</div><div id="corrList"></div></div>
</div>
<!-- TAB 2 -->
<div id="tab2" class="hide">
  <div class="warn-box"><div class="wt">ğŸŸ é®®é­šãŒå…¨ã¦ã‚’é£Ÿã£ã¦ã„ã‚‹</div>åŸä¾¡ç‡53%ã€‚<b>é®®é­šã ã‘ã§30%ã€‚</b>é£²æ–™11%ãƒ»é£Ÿæ11%ã¯é©æ­£ã€‚<br>ãƒã‚°ãƒ­ä»•å…¥å€¤ã¯2022â†’2024ã§<b>2ã€œ3å€ã«é«˜é¨°</b>ã€‚å£²å€¤æ®ãˆç½®ãâ†’åŸä¾¡ç‡æ‚ªåŒ–ã€‚</div>
  <div class="cd">
    <div class="cd-t">åŸä¾¡æ§‹é€ ï¼ˆç¨è¾¼/æ—¥ï¼‰</div>
    <div class="kv"><span class="k">ğŸŸ é®®é­š</span><span class="v" style="color:var(--red)">Â¥49,934 (30.5%)</span></div>
    <div class="kv"><span class="k">ğŸ¶ é£²æ–™</span><span class="v cf">Â¥17,737 (10.8%)</span></div>
    <div class="kv"><span class="k">ğŸ¥¬ é£Ÿæ</span><span class="v cfd">Â¥18,519 (11.3%)</span></div>
    <div class="kv" style="border-top:2px solid var(--ac)"><span class="k" style="color:var(--tx);font-weight:900">åˆè¨ˆ</span><span class="v" style="color:var(--ac);font-size:16px">Â¥86,190 (52.7%)</span></div>
  </div>
  <div class="cd">
    <div class="cd-t">ãªãœåˆºèº«ã®åŸä¾¡ç‡ãŒç•°å¸¸ã‹</div>
    <div style="font-size:12px;line-height:1.8;color:var(--dim)">
      <b style="color:var(--red)">ãƒã‚°ãƒ­ä»•å…¥å€¤ã®é«˜é¨°ï¼ˆ2022â†’2024ï¼‰</b><br>
      ãƒ¡ãƒãƒãƒã‚°ãƒ­: Â¥1,500/kg â†’ <b style="color:var(--red)">Â¥4,000/kg</b>ï¼ˆç´„2.7å€ï¼‰<br>
      åŸå› : å††å®‰ãƒ»ç‡ƒæ–™è²»ãƒ»ä¸–ç•Œçš„éœ€è¦å¢—<br><br>
      <b style="color:var(--tx)">å£²å€¤ã¯æ®ãˆç½®ã</b><br>
      ä»•å…¥2.7å€ãªã®ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¾¡æ ¼ã‚’å¤‰ãˆã¦ã„ãªã„<br>
      â†’ åŸä¾¡ç‡40%ã ã£ãŸåˆºèº«ãŒ<b style="color:var(--red)">88%è¶…</b>ã«<br><br>
      <b style="color:var(--food)">å¯¾ç­–ã¯3ã¤ã®çµ„ã¿åˆã‚ã›</b><br>
      â‘  å“æ•°å‰Šæ¸›ï¼ˆ106å“â†’20å“ä»¥ä¸‹ï¼‰<br>
      â‘¡ å€¤ä¸Šã’ï¼ˆä»•å…¥é«˜é¨°åˆ†ã‚’è»¢å«ï¼‰<br>
      â‘¢ ä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸ã‚·ãƒ•ãƒˆï¼ˆåŸä¾¡ç‡14%ï¼‰
    </div>
  </div>
  <div class="cd">
    <div class="cd-t">åŸä¾¡ç‡æ¯”è¼ƒ</div>
    <div class="kv"><span class="k">ğŸŸ åˆºèº«ï¼ˆæ¨å®šï¼‰</span><span class="v" style="color:var(--red);font-size:16px">88%</span></div>
    <div style="font-size:10px;color:var(--dim);padding-bottom:8px;border-bottom:1px solid var(--border)">â€»ä»•å…¥é«˜é¨°+å£²å€¤æ®ç½®ã€‚é®®é­šÂ¥49,934/æ—¥ã¯ç¢ºå®šã€‚</div>
    <div class="kv"><span class="k">ğŸ«› æè±†</span><span class="v cfd">8%</span></div>
    <div class="kv"><span class="k">ğŸ§Š å†·å¥´</span><span class="v cfd">7%</span></div>
    <div class="kv"><span class="k">ğŸ— å”æšã’</span><span class="v" style="color:var(--sake)">17%</span></div>
    <div class="kv"><span class="k">ğŸŸ ç„¼é­š</span><span class="v" style="color:var(--sake)">25%</span></div>
    <div class="kv" style="border-top:2px solid var(--food)"><span class="k" style="color:var(--tx)">ä»£æ›¿å¹³å‡</span><span class="v cfd" style="font-size:16px">14%</span></div>
  </div>
</div>
<!-- TAB 3: 3-AXIS SIMULATOR -->
<div id="tab3" class="hide">
  <div class="find"><div class="ft">ğŸ”® 3è»¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <b>å‰Šæ¸› Ã— å€¤ä¸Šã’ Ã— ä»£æ›¿</b>ã®åˆã‚ã›æŠ€ã§åˆ©ç›Šæ”¹å–„ã‚’è©¦ç®—ã€‚<br>
    ãƒã‚°ãƒ­ä»•å…¥å€¤2.7å€ã«å¯¾ã—ã€å£²å€¤æ®ç½®ã®ã¾ã¾ã§ã¯èµ¤å­—æ‹¡å¤§ã€‚
  </div>

  <div class="cd">
    <div class="cd-t">ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã‚¿ãƒƒãƒ—ã§è¨­å®šï¼‰</div>
    <div class="preset-row">
      <div class="preset" onclick="applyPreset(20,10,30)" style="border-color:var(--sake)"><b style="color:var(--sake)">ç©ã‚„ã‹</b>2å‰²æ¸›+å€¤ä¸Šã’</div>
      <div class="preset" onclick="applyPreset(50,15,50)" style="border-color:var(--ac)"><b style="color:var(--ac)">ãŠã™ã™ã‚</b>åŠæ¸›+å€¤ä¸Šã’+æ¨ã—</div>
      <div class="preset" onclick="applyPreset(70,20,70)" style="border-color:var(--food)"><b style="color:var(--food)">æœ¬æ°—æ”¹é©</b>7å‰²æ¸›+å€¤ä¸Šã’+æ¨ã—</div>
    </div>
  </div>

  <div class="cd">
    <div class="cd-t">ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§èª¿æ•´</div>
    <div class="sim-slider">
      <label>ğŸŸ åˆºèº«ã®å‰Šæ¸›ç‡ <b id="cutV">50%</b></label>
      <input type="range" id="cutR" min="0" max="100" step="10" value="50" oninput="simUpdate()">
      <div class="sim-ticks"><span>0%</span><span>50%</span><span>100%</span></div>
      <div style="font-size:10px;color:var(--dim);margin-top:3px">106å“â†’ä½•å“ã«çµã‚‹ã‹</div>
    </div>
    <div class="sim-slider">
      <label>ğŸ’´ æ®‹ã™åˆºèº«ã®å€¤ä¸Šã’ <b id="priceV">15%</b></label>
      <input type="range" id="priceR" min="0" max="50" step="5" value="15" oninput="simUpdate()">
      <div class="sim-ticks"><span>0%</span><span>15%</span><span>30%</span><span>50%</span></div>
      <div style="font-size:10px;color:var(--dim);margin-top:3px">ä»•å…¥å€¤2.7å€ã®è»¢å«ã€‚15%ã§ã‚‚æœ¬æ¥ä¸è¶³</div>
    </div>
    <div class="sim-slider">
      <label>ğŸ³ ä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼è»¢æ›ç‡ <b id="repV">50%</b></label>
      <input type="range" id="repR" min="0" max="100" step="10" value="50" oninput="simUpdate()">
      <div class="sim-ticks"><span>0%</span><span>50%</span><span>100%</span></div>
      <div style="font-size:10px;color:var(--dim);margin-top:3px">å¤±ã£ãŸåˆºèº«å£²ä¸Šâ†’æè±†ãƒ»ç„¼é³¥ç­‰ã«ç½®ãæ›ã‚ã‚‹å‰²åˆ</div>
    </div>
  </div>

  <div id="simResult"></div>

  <div class="cd" id="simCumCard">
    <div class="cd-t">ğŸ“ˆ æ¥æœˆã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã¨12ãƒ¶æœˆã§â€¦ï¼ˆ2025å¹´æœˆåˆ¥å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹ï¼‰</div>
    <div id="simCumChart"></div>
  </div>

  <div class="cd">
    <div class="cd-t">å‰ææ¡ä»¶</div>
    <div style="font-size:11px;color:var(--dim);line-height:1.8">
      ãƒ»æœˆåˆ¥å£²ä¸Šï¼2025å¹´POSå®Ÿç¸¾ï¼ˆå­£ç¯€å¤‰å‹•ã‚ã‚Šï¼‰<br>
      ãƒ»é®®é­šÂ¥49,934/æ—¥ï¼ˆç¢ºå®šï¼‰ã€‚åˆºèº«åŸä¾¡ç‡88%ï¼ˆæ¨å®šï¼‰<br>
      ãƒ»ä»£æ›¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¹³å‡åŸä¾¡ç‡14%<br>
      ãƒ»å€¤ä¸Šã’â†’æ³¨æ–‡æ¸›ã®å¼¾æ€§: å€¤ä¸Šã’10%ã§æ³¨æ–‡5%æ¸›<br>
      ãƒ»å“æ•°å‰Šæ¸›â†’å£²ä¸Šæ¸›ã®æ¨å®šå«ã‚€
    </div>
  </div>
</div>
<!-- TAB 4 -->
<div id="tab4" class="hide">
  <div class="cd"><div class="cd-t">äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«</div><div class="kv"><span class="k">ç¨®åˆ¥</span><span class="v">æ›œæ—¥Ã—æœˆÃ—å¤©å€™</span></div><div class="kv"><span class="k">å­¦ç¿’</span><span class="v">2025å¹´307å–¶æ¥­æ—¥</span></div><div class="kv"><span class="k">Â±30%ä»¥å†…</span><span class="v cfd">74.9%</span></div></div>
  <div class="cd"><div class="cd-t">åŸä¾¡ãƒ‡ãƒ¼ã‚¿(v4)</div><div class="kv"><span class="k">é®®é­š</span><span class="v">11æœˆãƒ¬ã‚·ãƒ¼ãƒˆ(æ—¥é¡â‰’å®Ÿæ…‹)</span></div><div class="kv"><span class="k">é£²æ–™</span><span class="v cfd">1æœˆç™½äº•é…’åº—è«‹æ±‚</span></div><div class="kv"><span class="k">é£Ÿæ</span><span class="v">11æœˆãƒ¬ã‚·ãƒ¼ãƒˆ</span></div></div>
  <div class="cd"><div class="cd-t">ä¿‚æ•°</div>
    <table style="width:100%;font-size:11px;border-collapse:collapse">
      <thead><tr style="color:var(--dim);border-bottom:1px solid var(--border)"><th style="padding:6px;text-align:left"></th><th style="padding:6px;text-align:center;color:var(--red)">ç¾çŠ¶53%</th><th style="padding:6px;text-align:center;color:var(--sake)">ç›®æ¨™37%</th><th style="padding:6px;text-align:center;color:var(--food)">æ¥­ç•Œ30%</th></tr></thead>
      <tbody>
        <tr style="border-bottom:1px solid var(--border)"><td style="padding:6px">ğŸŸé®®é­š</td><td style="padding:6px;text-align:center;color:var(--red);font-weight:700">30.5%</td><td style="padding:6px;text-align:center">15%</td><td style="padding:6px;text-align:center">12%</td></tr>
        <tr style="border-bottom:1px solid var(--border)"><td style="padding:6px">ğŸ¶é£²æ–™</td><td style="padding:6px;text-align:center">10.8%</td><td style="padding:6px;text-align:center">11%</td><td style="padding:6px;text-align:center">9%</td></tr>
        <tr style="border-bottom:1px solid var(--border)"><td style="padding:6px">ğŸ¥¬é£Ÿæ</td><td style="padding:6px;text-align:center">11.3%</td><td style="padding:6px;text-align:center">11%</td><td style="padding:6px;text-align:center">9%</td></tr>
        <tr><td style="padding:6px;font-weight:900">åˆè¨ˆ</td><td style="padding:6px;text-align:center;color:var(--red);font-weight:900">52.7%</td><td style="padding:6px;text-align:center;color:var(--sake);font-weight:900">37%</td><td style="padding:6px;text-align:center;color:var(--food);font-weight:900">30%</td></tr>
      </tbody>
    </table>
  </div>
</div>
</div>

<script>
const MONTHLY_SALES=[349,371,404,405,397,377,439,477,389,493,434,487];
const MONTH_NAMES=['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
const ANNUAL_SALES=MONTHLY_SALES.reduce((a,b)=>a+b,0);

const M={
  base:{æœˆ:155780,ç«:126785,æ°´:131680,æœ¨:148540,é‡‘:211595,åœŸ:195840,æ—¥:0},
  mf:{æœˆ:{1:.719,2:.846,3:.806,4:1.083,5:1.164,6:.649,7:.649,8:1.306,9:1.218,10:1.130,11:1.204,12:1.239},ç«:{1:.478,2:1.036,3:1.079,4:.797,5:1.005,6:.931,7:1.124,8:1.190,9:.730,10:1.303,11:1.027,12:1.376},æ°´:{1:.869,2:.932,3:1.088,4:.748,5:.876,6:.854,7:1.017,8:1.264,9:.876,10:1.334,11:.925,12:1.186},æœ¨:{1:1.018,2:1.142,3:.874,4:1.096,5:.914,6:.933,7:.966,8:1.129,9:.913,10:1.174,11:.998,12:.855},é‡‘:{1:1.042,2:.878,3:1.066,4:1.095,5:.743,6:1.052,7:1.192,8:.878,9:.806,10:1.004,11:1.153,12:1.168},åœŸ:{1:.848,2:.904,3:.853,4:.981,5:.950,6:1.098,7:1.062,8:1.093,9:1.016,10:.990,11:1.088,12:1.093}},
  wf:{æœˆ:{d:1,l:1.10,h:1.05,s:.56},ç«:{d:1,l:1.10,h:.89,s:.86},æ°´:{d:1,l:1.02,h:.80,s:.90},æœ¨:{d:1,l:.98,h:.92,s:.99},é‡‘:{d:1,l:1.14,h:.69,s:.92},åœŸ:{d:1,l:1.08,h:.93,s:.75}},
  modes:{
    current:{label:'ç¾çŠ¶',pct:53,fish:.305,drink:.108,food:.113,color:'#ef4444',badge:'red',desc:'âš  é®®é­š30%ãŒå…ƒå‡¶ã€‚'},
    target37:{label:'é®®é­šåŠæ¸›',pct:37,fish:.15,drink:.11,food:.11,color:'#eab308',badge:'yellow',desc:'é®®é­š30â†’15%ã€‚åˆºèº«20å“ä»¥ä¸‹ã€‚'},
    target30:{label:'æ¥­ç•Œæ°´æº–',pct:30,fish:.12,drink:.09,food:.09,color:'#22c55e',badge:'green',desc:'åˆºèº«5ã€œ8å“ã€‚é«˜åˆ©ç›Šä¸­å¿ƒã€‚'}
  }
};
let curMode='target37';
const DN=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
const WO=[{v:'d',l:'â˜€ æ™´/æ›‡',i:'â˜€'},{v:'l',l:'ğŸŒ¦ å°é›¨',i:'ğŸŒ¦'},{v:'h',l:'ğŸŒ§ å¤§é›¨',i:'ğŸŒ§'},{v:'s',l:'â„ é›ª',i:'â„'}];
function pred(dow,mo,w){if(dow==='æ—¥')return 0;return Math.round((M.base[dow]||0)*((M.mf[dow]||{})[mo]||1)*((M.wf[dow]||{})[w]||1))}
function yen(n){return n?'Â¥'+n.toLocaleString():'â€”'}
function yenK(n){return n>=10000?'Â¥'+(n/10000).toFixed(1)+'ä¸‡':n>=1000?'Â¥'+Math.round(n/1000)+'K':'Â¥'+n}
function showTab(n){document.querySelectorAll('.tab').forEach((t,i)=>{t.classList.toggle('on',i===n)});for(let i=0;i<5;i++)document.getElementById('tab'+i).classList.toggle('hide',i!==n)}
function initModes(){const s=document.getElementById('modeSel');s.innerHTML='';Object.entries(M.modes).forEach(([k,m])=>{const on=k===curMode;s.innerHTML+=`<div class="mode-btn${on?' on':''}" style="${on?'border-color:'+m.color+';background:'+m.color+'22;color:'+m.color:''}" onclick="setMode('${k}')"><span class="pct" style="${on?'color:'+m.color:''}">${m.pct}%</span>${m.label}<div class="mlabel">${k==='current'?'åŸä¾¡ç‡':'ç›®æ¨™'}</div></div>`});document.getElementById('modeDesc').innerHTML=`<span style="color:${M.modes[curMode].color}">â—</span> ${M.modes[curMode].desc}`}
function setMode(k){curMode=k;initModes()}
function getNextMon(){const d=new Date();const diff=d.getDay()===0?1:d.getDay()===1?0:8-d.getDay();d.setDate(d.getDate()+diff);return d}
function genWeek(){const inp=document.getElementById('sd');const s=inp.value?new Date(inp.value+'T00:00:00'):getNextMon();const fr=document.getElementById('frow');fr.innerHTML='';for(let i=0;i<7;i++){const d=new Date(s);d.setDate(s.getDate()+i);const dow=DN[d.getDay()],mo=d.getMonth()+1,dt=mo+'/'+d.getDate();const off=dow==='æ—¥',fs=dow==='é‡‘'||dow==='åœŸ';const div=document.createElement('div');div.className='fday'+(fs?' hi':'')+(off?' off':'');div.dataset.dow=dow;div.dataset.mo=mo;div.dataset.ds=d.getFullYear()+'/'+String(mo).padStart(2,'0')+'/'+String(d.getDate()).padStart(2,'0');if(off){div.innerHTML=`<div class="dt">${dt}</div><div class="dow" style="color:var(--mt)">${dow}</div><div class="wi" style="opacity:.3">ğŸš«</div><div style="font-size:10px;color:var(--mt)">å®šä¼‘</div>`}else{div.innerHTML=`<div class="dt">${dt}</div><div class="dow${fs?' fs':''}">${dow}</div><div class="wi" id="wi${i}">â˜€</div><select id="ws${i}" onchange="document.getElementById('wi${i}').textContent=WO.find(o=>o.v===this.value).i">${WO.map(o=>`<option value="${o.v}">${o.l}</option>`).join('')}</select>`}fr.appendChild(div)}document.getElementById('res').classList.add('hide')}

function calc(){
  const days=document.querySelectorAll('.fday');const md=M.modes[curMode],mc=M.modes.current;
  let wT=0,wF=0,wD=0,wFd=0,cF=0,cD=0,cFd=0;const results=[];
  days.forEach((el,i)=>{const dow=el.dataset.dow,mo=+el.dataset.mo,ds=el.dataset.ds;const sel=document.getElementById('ws'+i);const w=sel?sel.value:'d';const p=pred(dow,mo,w);const fa=(dow==='åœŸ')?.8:1;const fish=Math.round(p*md.fish*fa),drink=Math.round(p*md.drink),food=Math.round(p*md.food);wT+=p;wF+=fish;wD+=drink;wFd+=food;cF+=Math.round(p*mc.fish*fa);cD+=Math.round(p*mc.drink);cFd+=Math.round(p*mc.food);results.push({dow,mo,ds,w,p,fish,drink,food,off:dow==='æ—¥'})});
  const wPur=wF+wD+wFd,cPur=cF+cD+cFd,saving=cPur-wPur;
  document.getElementById('costAlert').innerHTML=curMode==='current'?`<div class="warn-box"><div class="wt">âš  ç¾çŠ¶53%</div><b>é®®é­šåŠæ¸›(37%)</b>åˆ‡æ›¿æ¨å¥¨ã€‚</div>`:saving>0?`<div class="find"><div class="ft">ğŸ’° ${md.label}(${md.pct}%)</div>ä»Šé€± <b>âˆ’${yen(saving)}</b>ï½œå¹´é–“<b style="font-size:16px">ç´„Â¥${Math.round(saving*52/10000)}ä¸‡æ”¹å–„</b></div>`:'';
  document.getElementById('sstrip').innerHTML=`<div class="sbox t1"><div class="sv">${yenK(wT)}</div><div class="sl">é€±é–“äºˆæ¸¬å£²ä¸Š</div></div><div class="sbox" style="border-color:var(--fish)"><div class="sv cf">${yen(wF)}</div><div class="sl">ğŸŸé®®é­š</div></div><div class="sbox" style="border-color:var(--sake)"><div class="sv cs">${yen(wD)}</div><div class="sl">ğŸ¶é£²æ–™</div></div><div class="sbox" style="border-color:var(--food)"><div class="sv cfd">${yen(wFd)}</div><div class="sl">ğŸ¥¬é£Ÿæ</div></div><div class="sbox" style="grid-column:1/3;border-color:${md.color}"><div class="sv" style="color:${md.color}">${yen(wPur)}</div><div class="sl">ä»•å…¥åˆè¨ˆ <span class="cost-badge ${md.badge}" style="margin-left:6px">${md.pct}%</span></div></div>`;
  const ca2=document.getElementById('compArea');
  if(curMode!=='current'&&saving>0){const mx=Math.max(cPur,wPur);ca2.innerHTML=`<div class="comp-bar"><div style="font-size:11px;color:var(--dim);margin-bottom:8px;font-weight:700">ç¾çŠ¶ vs ${md.label}</div><div class="comp-row"><div class="clbl">ç¾çŠ¶</div><div class="cbar"><div class="cfill" style="width:${cPur/mx*100}%;background:var(--red)">${yen(cPur)}</div></div></div><div class="comp-row"><div class="clbl">${md.label}</div><div class="cbar"><div class="cfill" style="width:${wPur/mx*100}%;background:${md.color}">${yen(wPur)}</div></div></div><div style="text-align:right;font-size:13px;font-weight:900;color:${md.color};margin-top:6px">âˆ’${yen(saving)}/é€±</div></div>`}else{ca2.innerHTML=''}
  const pc=document.getElementById('predCum'),pcc=document.getElementById('predCumChart');
  if(curMode!=='current'&&saving>0){pc.style.display='block';pcc.innerHTML=buildCumChart12(mc.fish+mc.drink+mc.food,md.fish+md.drink+md.food)}else{pc.style.display='none'}
  const rr=document.getElementById('rrow');rr.innerHTML='';
  results.forEach(r=>{const wi=WO.find(o=>o.v===r.w);const fs=r.dow==='é‡‘'||r.dow==='åœŸ';if(r.off){rr.innerHTML+=`<div class="rday off"><div class="rl"><div class="rdow">${r.dow}</div><div class="rdt">${r.ds.slice(5)}</div></div><div class="rc" style="color:var(--mt)">å®šä¼‘</div></div>`}else{rr.innerHTML+=`<div class="rday"><div class="rl"><div class="rdow${fs?' fs':''}">${r.dow}</div><div class="rdt">${r.ds.slice(5)}</div><div class="rwi">${wi?wi.i:'â˜€'}</div></div><div class="rc"><div class="rsal">${yenK(r.p)}<small>äºˆæ¸¬</small></div><div class="rpur"><div class="rp"><span class="dot df"></span>ğŸŸ<b class="cf">${yen(r.fish)}</b></div><div class="rp"><span class="dot ds"></span>ğŸ¶<b class="cs">${yen(r.drink)}</b></div><div class="rp"><span class="dot dfd"></span>ğŸ¥¬<b class="cfd">${yen(r.food)}</b></div></div></div></div>`}});
  document.getElementById('res').classList.remove('hide');document.getElementById('res').scrollIntoView({behavior:'smooth'});
}

// ===== CUMULATIVE CHART (2025 monthly) =====
function buildCumChart12(curCostRate,newCostRate){
  const now=new Date();const startIdx=(now.getMonth()+1)%12;
  let cumC=0,cumN=0;let h='';const data=[];
  for(let i=0;i<12;i++){const mi=(startIdx+i)%12;const s=MONTHLY_SALES[mi]*10000;cumC+=s*(1-curCostRate);cumN+=s*(1-newCostRate);data.push({mi,s,cumC,cumN,diff:cumN-cumC,mDiff:(s*(1-newCostRate))-(s*(1-curCostRate))})}
  const maxN=cumN;let peakI=0,peakV=0;data.forEach((d,i)=>{if(d.mDiff>peakV){peakV=d.mDiff;peakI=i}});
  for(let i=0;i<12;i++){
    const d=data[i];const mn=MONTH_NAMES[d.mi];const cPct=d.cumC/maxN*100;const dPct=(d.cumN-d.cumC)/maxN*100;const pk=i===peakI;
    h+=`<div style="margin-bottom:4px"><div style="display:flex;align-items:center;gap:4px">`;
    h+=`<div style="width:28px;font-size:10px;color:${pk?'var(--ac)':'var(--dim)'};text-align:right;flex-shrink:0;font-weight:${pk?900:400}">${mn}</div>`;
    h+=`<div style="flex:1"><div style="display:flex;height:24px;border-radius:4px;overflow:hidden;background:rgba(255,255,255,.03)">`;
    h+=`<div style="width:${cPct}%;background:var(--mt)"></div>`;
    h+=`<div style="width:${dPct}%;background:${pk?'var(--ac)':'var(--food)'};display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff">${dPct>5?'+Â¥'+Math.round(d.mDiff/10000)+'ä¸‡':''}</div>`;
    h+=`</div></div>`;
    h+=`<div style="width:55px;font-size:10px;font-weight:700;text-align:right;flex-shrink:0;color:var(--food)">+Â¥${Math.round(d.diff/10000)}ä¸‡</div>`;
    h+=`</div>`;
    if(i%3===0||pk)h+=`<div style="margin-left:32px;font-size:9px;color:var(--dim)">å£²ä¸ŠÂ¥${MONTHLY_SALES[d.mi]}ä¸‡${pk?' ğŸ”¥åŠ¹æœæœ€å¤§':''}</div>`;
    h+=`</div>`;
  }
  h+=`<div class="cum-total-line" style="color:var(--food)">12ãƒ¶æœˆ: <span style="font-size:24px">+Â¥${Math.round(data[11].diff/10000)}ä¸‡</span></div>`;
  h+=`<div class="cum-legend"><span><i style="background:var(--mt)"></i>ç¾çŠ¶ç²—åˆ©</span><span><i style="background:var(--food)"></i>æ”¹å–„å¢—åˆ†</span><span style="color:var(--ac)">ğŸ”¥ç¹å¿™æœˆ</span></div>`;
  h+=`<div style="font-size:10px;color:var(--dim);margin-top:6px">â€»2025å¹´POSæœˆåˆ¥å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹</div>`;
  return h;
}

// ===== 3-AXIS SIMULATOR =====
const SIM={dailySales:163565,opDays:307,sashimiSales:45635,sashimiPurchase:39947,otherFishPurchase:9987,drinkCost:17737,foodCost:18519,replaceCostRate:0.14,sashimiCostRate:0.88};

function simCalc(cutPct,pricePct,repPct){
  const C=SIM;
  // 1. Remaining sashimi after cut
  const remainRatio=1-cutPct/100;
  // Remaining sashimi purchase (proportional)
  const remainSashimiPurchase=C.sashimiPurchase*remainRatio;
  // Remaining sashimi sales WITH price increase
  // Price up â†’ some volume loss (elasticity: 10% price up â†’ 5% volume down)
  const priceElasticity=0.5;
  const volumeLossFromPrice=pricePct/100*priceElasticity;
  const remainSashimiSales=C.sashimiSales*remainRatio*(1+pricePct/100)*(1-volumeLossFromPrice);
  // Adjust purchase for volume loss from price
  const adjustedSashimiPurchase=remainSashimiPurchase*(1-volumeLossFromPrice);
  
  // 2. Fish cost
  const newFishCost=adjustedSashimiPurchase+C.otherFishPurchase;
  
  // 3. Lost sashimi sales (before price effect)
  const lostSashimiSales=C.sashimiSales-remainSashimiSales;
  // Replacement: portion of lost sales captured by alt menu
  const replacedSales=Math.max(0,lostSashimiSales)*(repPct/100);
  const replaceCost=replacedSales*C.replaceCostRate;
  
  // 4. Overall sales impact
  // Base sales drop from fewer sashimi items
  const salesDropBase=cutPct<=30?cutPct*0.17:cutPct<=50?5+((cutPct-30)*0.15):cutPct<=70?8+((cutPct-50)*0.20):cutPct<=90?12+((cutPct-70)*0.15):15+((cutPct-90)*0.2);
  // Price increase mitigates slightly (captures more per remaining customer)
  // Replacement mitigates (gives customers alternatives)
  const mitigate=repPct/100*0.35+pricePct/100*0.15;
  const salesDropPct=Math.max(0,salesDropBase*(1-mitigate));
  
  const newDailySales=C.dailySales*(1-salesDropPct/100);
  const newDrinkCost=C.drinkCost*(1-salesDropPct/100*0.5);
  const newFoodCost=C.foodCost+replaceCost;
  const newTotalCost=newFishCost+newDrinkCost+newFoodCost;
  
  const currentCost=C.sashimiPurchase+C.otherFishPurchase+C.drinkCost+C.foodCost;
  const currentGross=C.dailySales-currentCost;
  const newGross=newDailySales-newTotalCost;
  const newGrossRate=newDailySales>0?newGross/newDailySales:0;
  const annualDiff=(newGross-currentGross)*C.opDays;
  
  // New sashimi cost rate
  const newSashimiCostRate=remainSashimiSales>0?adjustedSashimiPurchase/remainSashimiSales:0;
  
  // Cost rates for chart
  const curCostRate=currentCost/C.dailySales;
  const newCostRate=newDailySales>0?newTotalCost/newDailySales:0;
  
  // Break-even
  let bep=0;
  for(let d=0;d<=40;d++){
    const s=C.dailySales*(1-d/100);
    const nc=newFishCost+C.drinkCost*(1-d/100*0.5)+newFoodCost;
    if(s-nc<currentGross){bep=d;break}
    if(d===40)bep=40;
  }
  return{newSales:newDailySales,newTotalCost,newGross,newGrossRate,annualDiff,salesDropPct,currentGross,bep,curCostRate,newCostRate,newSashimiCostRate,newFishCost};
}

function applyPreset(cut,price,rep){
  document.getElementById('cutR').value=cut;
  document.getElementById('priceR').value=price;
  document.getElementById('repR').value=rep;
  simUpdate();
}

function simUpdate(){
  const cut=+document.getElementById('cutR').value;
  const price=+document.getElementById('priceR').value;
  const rep=+document.getElementById('repR').value;
  document.getElementById('cutV').textContent=cut+'%';
  document.getElementById('priceV').textContent=price+'%';
  document.getElementById('repV').textContent=rep+'%';
  
  const r=simCalc(cut,price,rep);
  const C=SIM;const diffAbs=Math.abs(r.annualDiff);const isPlus=r.annualDiff>=0;
  let h='';
  
  // Big result
  if(isPlus){h+=`<div class="sim-big" style="background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.3)"><div class="sb-v" style="color:var(--food)">+Â¥${Math.round(diffAbs/10000)}ä¸‡/å¹´</div><div class="sb-l">å£²ä¸Š${r.salesDropPct.toFixed(0)}%æ¸›ã§ã‚‚ç²—åˆ©<b style="color:var(--food)">UP</b></div></div>`}
  else{h+=`<div class="sim-big" style="background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3)"><div class="sb-v" style="color:var(--red)">âˆ’Â¥${Math.round(diffAbs/10000)}ä¸‡/å¹´</div><div class="sb-l">ç²—åˆ©æ¸›å°‘</div></div>`}
  
  // VS
  h+=`<div class="sim-vs"><div class="sv-box"><div class="svv" style="color:var(--dim)">${yen(Math.round(C.dailySales))}</div><div class="svl">ç¾çŠ¶æ—¥è²©</div><div style="font-size:11px;margin-top:4px">ç²—åˆ©${yen(Math.round(r.currentGross))}</div><div style="font-size:10px;color:var(--dim)">ç‡${(r.currentGross/C.dailySales*100).toFixed(0)}%</div></div><div class="sv-arrow">â†’</div><div class="sv-box" style="border-color:${isPlus?'var(--food)':'var(--red)'}"><div class="svv" style="color:var(--ac)">${yen(Math.round(r.newSales))}</div><div class="svl">æ”¹å–„å¾Œæ—¥è²©</div><div style="font-size:11px;margin-top:4px;color:${isPlus?'var(--food)':'var(--red)'}">ç²—åˆ©${yen(Math.round(r.newGross))}</div><div style="font-size:10px;color:${isPlus?'var(--food)':'var(--red)'}">ç‡${(r.newGrossRate*100).toFixed(0)}%</div></div></div>`;
  
  // Effect breakdown
  h+=`<div class="cd" style="margin:12px 0"><div class="cd-t">3è»¸ã®åŠ¹æœå†…è¨³</div>`;
  const fishSaving=(C.sashimiPurchase-r.newFishCost+C.otherFishPurchase);
  h+=`<div class="kv"><span class="k">ğŸŸ å‰Šæ¸›${cut}%ã®åŠ¹æœ</span><span class="v" style="color:var(--fish)">ä»•å…¥âˆ’${yen(Math.round(Math.max(0,C.sashimiPurchase+C.otherFishPurchase-r.newFishCost)))}/æ—¥</span></div>`;
  if(price>0){
    const oldCR=C.sashimiCostRate;
    const newCR=r.newSashimiCostRate;
    h+=`<div class="kv"><span class="k">ğŸ’´ å€¤ä¸Šã’${price}%ã®åŠ¹æœ</span><span class="v" style="color:var(--sake)">åŸä¾¡ç‡${(oldCR*100).toFixed(0)}%â†’${(newCR*100).toFixed(0)}%</span></div>`;
  }
  h+=`<div class="kv"><span class="k">ğŸ³ ä»£æ›¿${rep}%ã®åŠ¹æœ</span><span class="v" style="color:var(--food)">å£²ä¸Šæ¸›ã‚’è£œå¡«</span></div>`;
  h+=`</div>`;
  
  // BEP
  h+=`<div class="bep-box"><div class="bep-l">ğŸ’¡ æç›Šåˆ†å²ç‚¹</div><div class="bep-v">å£²ä¸Š${r.bep>39?'40+':r.bep}%æ¸›ã¾ã§è€ãˆã‚‹</div><div class="bep-l">ã“ã‚Œä»¥å†…ã®å£²ä¸Šæ¸›ãªã‚‰ç²—åˆ©ã¯ä»Šã‚ˆã‚Šå¢—ãˆã‚‹</div></div>`;
  
  document.getElementById('simResult').innerHTML=h;
  
  // 12-month chart
  document.getElementById('simCumChart').innerHTML=buildCumChart12(r.curCostRate,r.newCostRate);
}

// ===== ANALYSIS =====
function initAnalysis(){
  const dw=[{d:'æœˆ',v:148165},{d:'ç«',v:134484},{d:'æ°´',v:141542},{d:'æœ¨',v:153585},{d:'é‡‘',v:207285},{d:'åœŸ',v:195104}];const mx=Math.max(...dw.map(x=>x.v));
  document.getElementById('dowList').innerHTML=dw.map(x=>{const p=x.v/mx*100;const c=x.d==='é‡‘'||x.d==='åœŸ'?'var(--ac)':'var(--blue)';return`<div class="arow"><div class="al">${x.d}æ›œ</div><div class="av" style="color:${c}">${yenK(x.v)}</div></div><div class="abr" style="width:${p}%;background:${c}"></div>`}).join('');
  const tm=[{h:'17æ™‚',p:12.1},{h:'18æ™‚',p:27.4},{h:'19æ™‚',p:26.1},{h:'20æ™‚',p:15.9},{h:'21æ™‚',p:10.0},{h:'22æ™‚',p:5.9},{h:'23æ™‚',p:2.3},{h:'24æ™‚',p:0.3}];const tmx=Math.max(...tm.map(x=>x.p));
  document.getElementById('timeList').innerHTML=tm.map(x=>{const p=x.p/tmx*100;const c=x.p>20?'var(--ac)':x.p>10?'var(--blue)':'var(--mt)';return`<div class="arow"><div class="al">${x.h}</div><div class="av" style="color:${c}">${x.p}%</div></div><div class="abr" style="width:${p}%;background:${c}"></div>`}).join('');
  const wt=[{d:'æœˆ',a:143,b:158,c:150,e:80},{d:'ç«',a:135,b:149,c:120,e:115},{d:'æ°´',a:147,b:151,c:118,e:132},{d:'æœ¨',a:156,b:153,c:143,e:154},{d:'é‡‘',a:205,b:234,c:161,e:212},{d:'åœŸ',a:193,b:208,c:195,e:157}];
  document.getElementById('wtbl').innerHTML=wt.map(x=>{const fs=x.d==='é‡‘'||x.d==='åœŸ'?'color:var(--ac);font-weight:700':'';const cl=(v,b)=>v/b<.8?'color:var(--red);font-weight:700':v/b>1.1?'color:var(--food);font-weight:700':'';return`<tr style="border-bottom:1px solid var(--border)"><td style="padding:6px;${fs}">${x.d}</td><td style="padding:6px;text-align:right">Â¥${x.a}K</td><td style="padding:6px;text-align:right;${cl(x.b,x.a)}">Â¥${x.b}K</td><td style="padding:6px;text-align:right;${cl(x.c,x.a)}">Â¥${x.c}K</td><td style="padding:6px;text-align:right;${cl(x.e,x.a)}">Â¥${x.e}K</td></tr>`}).join('');
  const mo=MONTHLY_SALES.map((v,i)=>({m:MONTH_NAMES[i],v}));const mmx=Math.max(...mo.map(x=>x.v));
  document.getElementById('monList').innerHTML=mo.map(x=>{const p=x.v/mmx*100;const c=x.v>450?'var(--ac)':'var(--blue)';return`<div class="arow"><div class="al">${x.m}</div><div class="av" style="color:${c}">Â¥${x.v}ä¸‡</div></div><div class="abr" style="width:${p}%;background:${c}"></div>`}).join('');
  const cr=[{l:'é‡‘åœŸãƒ€ãƒŸãƒ¼',v:.473,c:'var(--ac)'},{l:'æœˆ',v:.201,c:'var(--blue)'},{l:'æ—¥ç…§',v:.053,c:'var(--mt)'},{l:'æ°—æ¸©',v:.024,c:'var(--mt)'},{l:'é™æ°´',v:-.036,c:'var(--mt)'}];
  document.getElementById('corrList').innerHTML=cr.map(x=>{const p=Math.abs(x.v)/.5*100;return`<div class="arow"><div class="al">${x.l}</div><div class="av" style="color:${x.c}">${x.v>=0?'+':''}${x.v.toFixed(3)}</div></div><div class="abr" style="width:${p}%;background:${x.c}"></div>`}).join('');
}

window.addEventListener('DOMContentLoaded',()=>{const m=getNextMon();document.getElementById('sd').value=m.toISOString().split('T')[0];genWeek();initModes();initAnalysis();simUpdate()});
</script>
</body>
</html>
